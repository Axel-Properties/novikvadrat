{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 46, "column": 0}, "map": {"version":3,"sources":["file:///Users/abdullahkahvecioglu/DEV/novikvadrat/novi-kvadrat-web/src/lib/supabase/server.ts"],"sourcesContent":["import { createServerClient } from '@supabase/ssr'\nimport { cookies } from 'next/headers'\n\nexport async function createClient() {\n  const cookieStore = await cookies()\n\n  return createServerClient(\n    process.env.NEXT_PUBLIC_SUPABASE_URL!,\n    process.env.NEXT_PUBLIC_SUPABASE_ANON_KEY!,\n    {\n      cookies: {\n        getAll() {\n          return cookieStore.getAll()\n        },\n        setAll(cookiesToSet) {\n          try {\n            cookiesToSet.forEach(({ name, value, options }) => {\n              cookieStore.set(name, value, options)\n            })\n          } catch (error) {\n            // The `set` method was called from a Server Component.\n            // This can be ignored if you have middleware refreshing\n            // user sessions.\n          }\n        },\n      },\n    }\n  )\n}"],"names":[],"mappings":";;;;AAAA;AAAA;AACA;;;AAEO,eAAe;IACpB,MAAM,cAAc,MAAM,IAAA,4IAAO;IAEjC,OAAO,IAAA,iMAAkB,sUAGvB;QACE,SAAS;YACP;gBACE,OAAO,YAAY,MAAM;YAC3B;YACA,QAAO,YAAY;gBACjB,IAAI;oBACF,aAAa,OAAO,CAAC,CAAC,EAAE,IAAI,EAAE,KAAK,EAAE,OAAO,EAAE;wBAC5C,YAAY,GAAG,CAAC,MAAM,OAAO;oBAC/B;gBACF,EAAE,OAAO,OAAO;gBACd,uDAAuD;gBACvD,wDAAwD;gBACxD,iBAAiB;gBACnB;YACF;QACF;IACF;AAEJ"}},
    {"offset": {"line": 80, "column": 0}, "map": {"version":3,"sources":["file:///Users/abdullahkahvecioglu/DEV/novikvadrat/novi-kvadrat-web/src/app/api/projects/%5Bslug%5D/route.ts"],"sourcesContent":["import { NextRequest, NextResponse } from 'next/server'\nimport { createClient } from '@/lib/supabase/server'\n\nexport async function GET(\n  request: NextRequest,\n  { params }: { params: Promise<{ slug: string }> }\n) {\n  try {\n    const { slug } = await params\n    const supabase = await createClient()\n    \n    // Fetch project with all related data\n    const { data: project, error } = await supabase\n      .from('projects')\n      .select(`\n        *,\n        developer:developers(*),\n        city:cities(*),\n        municipality:municipalities(*),\n        images:project_images(*),\n        layouts:layouts(*),\n        amenities:project_amenities(\n          amenity:amenities(*)\n        )\n      `)\n      .eq('slug', slug)\n      .eq('is_active', true)\n      .single()\n    \n    if (error) {\n      throw error\n    }\n    \n    if (!project) {\n      return NextResponse.json(\n        { success: false, error: 'Project not found' },\n        { status: 404 }\n      )\n    }\n    \n    // Increment view count\n    await supabase\n      .from('projects')\n      .update({ views_count: (project.views_count || 0) + 1 })\n      .eq('id', project.id)\n    \n    // Get similar projects\n    const { data: similarProjects } = await supabase\n      .from('projects')\n      .select(`\n        id,\n        name,\n        slug,\n        price_from,\n        price_per_sqm_from,\n        main_image_url,\n        municipality:municipalities(name_sr_lat)\n      `)\n      .eq('city_id', project.city_id)\n      .neq('id', project.id)\n      .eq('is_active', true)\n      .limit(4)\n    \n    // Get price history for price dynamics chart\n    const { data: priceHistory } = await supabase\n      .from('project_price_history')\n      .select('*')\n      .eq('project_id', project.id)\n      .order('recorded_at', { ascending: true })\n    \n    // Get project buildings (for multi-building projects)\n    const { data: buildings } = await supabase\n      .from('project_buildings')\n      .select('*')\n      .eq('project_id', project.id)\n      .order('sort_order', { ascending: true })\n    \n    // Get construction progress spots with photo count\n    const { data: constructionProgressRaw } = await supabase\n      .from('construction_progress_spots')\n      .select(`\n        *,\n        photos:construction_progress_photos(count)\n      `)\n      .eq('project_id', project.id)\n      .order('sort_order', { ascending: true })\n    \n    // Transform construction progress to include photo count\n    const constructionProgress = constructionProgressRaw?.map((spot: any) => ({\n      ...spot,\n      photo_count: spot.photos?.[0]?.count || 0,\n      photos: undefined // Remove the nested count query result\n    })) || []\n    \n    return NextResponse.json({\n      success: true,\n      data: {\n        ...project,\n        amenities: project.amenities?.map((a: any) => a.amenity) || [],\n        similarProjects: similarProjects || [],\n        priceHistory: priceHistory || [],\n        buildings: buildings || [],\n        constructionProgress\n      }\n    })\n  } catch (error) {\n    console.error('Project detail API error:', error)\n    return NextResponse.json(\n      { \n        success: false, \n        error: error instanceof Error ? error.message : 'Failed to fetch project' \n      },\n      { status: 500 }\n    )\n  }\n}"],"names":[],"mappings":";;;;AAAA;AACA;;;AAEO,eAAe,IACpB,OAAoB,EACpB,EAAE,MAAM,EAAyC;IAEjD,IAAI;QACF,MAAM,EAAE,IAAI,EAAE,GAAG,MAAM;QACvB,MAAM,WAAW,MAAM,IAAA,kJAAY;QAEnC,sCAAsC;QACtC,MAAM,EAAE,MAAM,OAAO,EAAE,KAAK,EAAE,GAAG,MAAM,SACpC,IAAI,CAAC,YACL,MAAM,CAAC,CAAC;;;;;;;;;;MAUT,CAAC,EACA,EAAE,CAAC,QAAQ,MACX,EAAE,CAAC,aAAa,MAChB,MAAM;QAET,IAAI,OAAO;YACT,MAAM;QACR;QAEA,IAAI,CAAC,SAAS;YACZ,OAAO,gJAAY,CAAC,IAAI,CACtB;gBAAE,SAAS;gBAAO,OAAO;YAAoB,GAC7C;gBAAE,QAAQ;YAAI;QAElB;QAEA,uBAAuB;QACvB,MAAM,SACH,IAAI,CAAC,YACL,MAAM,CAAC;YAAE,aAAa,CAAC,QAAQ,WAAW,IAAI,CAAC,IAAI;QAAE,GACrD,EAAE,CAAC,MAAM,QAAQ,EAAE;QAEtB,uBAAuB;QACvB,MAAM,EAAE,MAAM,eAAe,EAAE,GAAG,MAAM,SACrC,IAAI,CAAC,YACL,MAAM,CAAC,CAAC;;;;;;;;MAQT,CAAC,EACA,EAAE,CAAC,WAAW,QAAQ,OAAO,EAC7B,GAAG,CAAC,MAAM,QAAQ,EAAE,EACpB,EAAE,CAAC,aAAa,MAChB,KAAK,CAAC;QAET,6CAA6C;QAC7C,MAAM,EAAE,MAAM,YAAY,EAAE,GAAG,MAAM,SAClC,IAAI,CAAC,yBACL,MAAM,CAAC,KACP,EAAE,CAAC,cAAc,QAAQ,EAAE,EAC3B,KAAK,CAAC,eAAe;YAAE,WAAW;QAAK;QAE1C,sDAAsD;QACtD,MAAM,EAAE,MAAM,SAAS,EAAE,GAAG,MAAM,SAC/B,IAAI,CAAC,qBACL,MAAM,CAAC,KACP,EAAE,CAAC,cAAc,QAAQ,EAAE,EAC3B,KAAK,CAAC,cAAc;YAAE,WAAW;QAAK;QAEzC,mDAAmD;QACnD,MAAM,EAAE,MAAM,uBAAuB,EAAE,GAAG,MAAM,SAC7C,IAAI,CAAC,+BACL,MAAM,CAAC,CAAC;;;MAGT,CAAC,EACA,EAAE,CAAC,cAAc,QAAQ,EAAE,EAC3B,KAAK,CAAC,cAAc;YAAE,WAAW;QAAK;QAEzC,yDAAyD;QACzD,MAAM,uBAAuB,yBAAyB,IAAI,CAAC,OAAc,CAAC;gBACxE,GAAG,IAAI;gBACP,aAAa,KAAK,MAAM,EAAE,CAAC,EAAE,EAAE,SAAS;gBACxC,QAAQ,UAAU,uCAAuC;YAC3D,CAAC,MAAM,EAAE;QAET,OAAO,gJAAY,CAAC,IAAI,CAAC;YACvB,SAAS;YACT,MAAM;gBACJ,GAAG,OAAO;gBACV,WAAW,QAAQ,SAAS,EAAE,IAAI,CAAC,IAAW,EAAE,OAAO,KAAK,EAAE;gBAC9D,iBAAiB,mBAAmB,EAAE;gBACtC,cAAc,gBAAgB,EAAE;gBAChC,WAAW,aAAa,EAAE;gBAC1B;YACF;QACF;IACF,EAAE,OAAO,OAAO;QACd,QAAQ,KAAK,CAAC,6BAA6B;QAC3C,OAAO,gJAAY,CAAC,IAAI,CACtB;YACE,SAAS;YACT,OAAO,iBAAiB,QAAQ,MAAM,OAAO,GAAG;QAClD,GACA;YAAE,QAAQ;QAAI;IAElB;AACF"}}]
}