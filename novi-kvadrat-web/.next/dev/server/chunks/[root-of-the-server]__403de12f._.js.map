{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 46, "column": 0}, "map": {"version":3,"sources":["file:///Users/abdullahkahvecioglu/DEV/novikvadrat/novi-kvadrat-web/src/lib/supabase/server.ts"],"sourcesContent":["import { createServerClient } from '@supabase/ssr'\nimport { cookies } from 'next/headers'\n\nexport async function createClient() {\n  const cookieStore = await cookies()\n\n  return createServerClient(\n    process.env.NEXT_PUBLIC_SUPABASE_URL!,\n    process.env.NEXT_PUBLIC_SUPABASE_ANON_KEY!,\n    {\n      cookies: {\n        getAll() {\n          return cookieStore.getAll()\n        },\n        setAll(cookiesToSet) {\n          try {\n            cookiesToSet.forEach(({ name, value, options }) => {\n              cookieStore.set(name, value, options)\n            })\n          } catch (error) {\n            // The `set` method was called from a Server Component.\n            // This can be ignored if you have middleware refreshing\n            // user sessions.\n          }\n        },\n      },\n    }\n  )\n}"],"names":[],"mappings":";;;;AAAA;AAAA;AACA;;;AAEO,eAAe;IACpB,MAAM,cAAc,MAAM,IAAA,4IAAO;IAEjC,OAAO,IAAA,iMAAkB,sUAGvB;QACE,SAAS;YACP;gBACE,OAAO,YAAY,MAAM;YAC3B;YACA,QAAO,YAAY;gBACjB,IAAI;oBACF,aAAa,OAAO,CAAC,CAAC,EAAE,IAAI,EAAE,KAAK,EAAE,OAAO,EAAE;wBAC5C,YAAY,GAAG,CAAC,MAAM,OAAO;oBAC/B;gBACF,EAAE,OAAO,OAAO;gBACd,uDAAuD;gBACvD,wDAAwD;gBACxD,iBAAiB;gBACnB;YACF;QACF;IACF;AAEJ"}},
    {"offset": {"line": 80, "column": 0}, "map": {"version":3,"sources":["file:///Users/abdullahkahvecioglu/DEV/novikvadrat/novi-kvadrat-web/src/app/api/projects/route.ts"],"sourcesContent":["import { NextRequest, NextResponse } from 'next/server'\nimport { createClient } from '@/lib/supabase/server'\n\nexport async function GET(request: NextRequest) {\n  try {\n    const searchParams = request.nextUrl.searchParams\n    const supabase = await createClient()\n    \n    // Parse query parameters\n    const city = searchParams.get('city')\n    const municipality = searchParams.get('municipality')\n    const status = searchParams.get('status')\n    const priceMin = searchParams.get('price_min')\n    const priceMax = searchParams.get('price_max')\n    const pricePerSqmMin = searchParams.get('price_per_sqm_min')\n    const pricePerSqmMax = searchParams.get('price_per_sqm_max')\n    const developer = searchParams.get('developer')\n    const featured = searchParams.get('featured')\n    const sort = searchParams.get('sort') || 'featured'\n    const page = parseInt(searchParams.get('page') || '1')\n    const limit = parseInt(searchParams.get('limit') || '20')\n    \n    console.log('API Filters:', { city, municipality, status, sort, page })\n    \n    // Start building the query\n    let query = supabase\n      .from('projects')\n      .select(`\n        *,\n        developer:developers(id, name, slug, is_verified),\n        city:cities(id, name_en, name_sr_lat, slug),\n        municipality:municipalities(id, name_en, name_sr_lat, slug)\n      `, { count: 'exact' })\n      .eq('is_active', true)\n    \n    // Apply filters\n    if (city) {\n      const { data: cityData } = await supabase\n        .from('cities')\n        .select('id')\n        .eq('slug', city)\n        .single()\n      \n      if (cityData) {\n        query = query.eq('city_id', cityData.id)\n      }\n    }\n    \n    if (municipality) {\n      const { data: municipalityData } = await supabase\n        .from('municipalities')\n        .select('id')\n        .eq('slug', municipality)\n        .single()\n      \n      console.log('Municipality lookup:', municipality, municipalityData)\n      \n      if (municipalityData) {\n        query = query.eq('municipality_id', municipalityData.id)\n      }\n    }\n    \n    if (status) {\n      console.log('Applying status filter:', status)\n      query = query.eq('construction_status', status)\n    }\n    \n    if (priceMin) {\n      query = query.gte('price_from', priceMin)\n    }\n    \n    if (priceMax) {\n      query = query.lte('price_to', priceMax)\n    }\n    \n    if (pricePerSqmMin) {\n      query = query.gte('price_per_sqm_from', pricePerSqmMin)\n    }\n    \n    if (pricePerSqmMax) {\n      query = query.lte('price_per_sqm_to', pricePerSqmMax)\n    }\n    \n    if (developer) {\n      const { data: developerData } = await supabase\n        .from('developers')\n        .select('id')\n        .eq('slug', developer)\n        .single()\n      \n      if (developerData) {\n        query = query.eq('developer_id', developerData.id)\n      }\n    }\n    \n    if (featured === 'true') {\n      query = query.eq('featured', true)\n    }\n    \n    // Apply sorting\n    switch (sort) {\n      case 'price_asc':\n        query = query.order('price_from', { ascending: true, nullsLast: true })\n        break\n      case 'price_desc':\n        query = query.order('price_from', { ascending: false, nullsFirst: true })\n        break\n      case 'newest':\n        query = query.order('created_at', { ascending: false })\n        break\n      case 'completion':\n        query = query.order('completion_date', { ascending: true, nullsLast: true })\n        break\n      case 'featured':\n      default:\n        query = query\n          .order('featured', { ascending: false })\n          .order('featured_order', { ascending: true, nullsLast: true })\n          .order('created_at', { ascending: false })\n        break\n    }\n    \n    // Apply pagination\n    const offset = (page - 1) * limit\n    query = query.range(offset, offset + limit - 1)\n    \n    // Execute query\n    const { data, error, count } = await query\n    \n    if (error) {\n      throw error\n    }\n    \n    // Get aggregations for filters\n    const aggregations = await getAggregations(supabase, city)\n    \n    return NextResponse.json({\n      success: true,\n      data: data || [],\n      pagination: {\n        page,\n        limit,\n        total: count || 0,\n        totalPages: Math.ceil((count || 0) / limit)\n      },\n      aggregations\n    })\n  } catch (error) {\n    console.error('Projects API error:', error)\n    return NextResponse.json(\n      { \n        success: false, \n        error: error instanceof Error ? error.message : 'Failed to fetch projects' \n      },\n      { status: 500 }\n    )\n  }\n}\n\nasync function getAggregations(supabase: any, citySlug?: string | null) {\n  const aggregations: any = {}\n  \n  // Get municipalities for the selected city\n  if (citySlug) {\n    const { data: city } = await supabase\n      .from('cities')\n      .select('id')\n      .eq('slug', citySlug)\n      .single()\n    \n    if (city) {\n      const { data: municipalities } = await supabase\n        .from('municipalities')\n        .select('id, name_en, name_sr_lat, slug')\n        .eq('city_id', city.id)\n        .order('name_en')\n      \n      aggregations.municipalities = municipalities || []\n    }\n  }\n  \n  // Get construction statuses with counts\n  const { data: statuses } = await supabase\n    .from('projects')\n    .select('construction_status')\n    .eq('is_active', true)\n    .not('construction_status', 'is', null)\n  \n  if (statuses) {\n    const statusCounts = statuses.reduce((acc: any, proj: any) => {\n      acc[proj.construction_status] = (acc[proj.construction_status] || 0) + 1\n      return acc\n    }, {})\n    \n    aggregations.statuses = Object.entries(statusCounts).map(([status, count]) => ({\n      status,\n      count,\n      label: getStatusLabel(status as string)\n    }))\n  }\n  \n  // Get price ranges\n  const { data: priceData } = await supabase\n    .from('projects')\n    .select('price_from, price_to')\n    .eq('is_active', true)\n    .not('price_from', 'is', null)\n  \n  if (priceData && priceData.length > 0) {\n    const prices = priceData.map((p: any) => p.price_from).filter(Boolean)\n    aggregations.priceRange = {\n      min: Math.min(...prices),\n      max: Math.max(...prices)\n    }\n  }\n  \n  return aggregations\n}\n\nfunction getStatusLabel(status: string): string {\n  const labels: { [key: string]: string } = {\n    'planning': 'U planiranju',\n    'u_izgradnji': 'U izgradnji',\n    'siva_faza': 'Siva faza',\n    'useljivo': 'Useljivo',\n    'completed': 'Zavr≈°eno'\n  }\n  return labels[status] || status\n}"],"names":[],"mappings":"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"}}]
}